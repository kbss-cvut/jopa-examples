# JOPA ESWC 2016 Demo

This is a demo of JOPA features for the ESWC 2016 conference.

### Features

This demo is a comprehensive showcase of most of JOPA's features. It shows:

- Integration with CDI containers (Spring)
- Querying (SPARQL-DL) - DAOs
- Inferred attributes - `Event.isDocumentedBy`
- cascading - `Report.has_documentation_part`, `Record.has_answer`
- participation constraints - basically all entities, but e.g. `Report.documents` has also minimum
- contexts - `Report.hasAuthor`, used by Sesame, no effect in OWL API
- Object model generated by OWL2Java
- Storage switch - switch can be done in UI, tab `Settings`
- Properties - can be set for `Event`s and `Report`s
- Types - used to classify `Record`
- Possible to view raw storage content in UI - tab `Data`

It is a simplified version of a larger reporting tool developed for the [INBAS](https://www.inbas.cz) project.

#### EntityManagerFactory as a Spring Bean

JOPA's `EntityManagerFactory` (EMF) is created as a Spring bean and managed by the Spring context. The classes
`cz.cvut.kbss.jopa.eswc2016.persistence.SesamePersistenceFactory` and `cz.cvut.kbss.jopa.eswc2016.persistence.OwlapiPersistenceFactory`
 after their initialization instantiate EMFs and provides them as beans. 
The EMF instance are closed before application shutdown.

#### EntityManager in Data Access Objects

`EntityManager` - the main entry point of JOPA for the application is used in DAOs in a manner similar to standard JPA. The main
difference is that since JOPA is not a JPA implementation, declarative transaction demarcation provided by Spring (`@Transactional`)
cannot be used and transaction have to be managed manually. See for example the `BaseDao` class.

#### Generated model

The object model of the application is generated from integrity constraints by the OWL2Java tool. However, this strategy currently has
some drawbacks. Mainly, the classes are always completely rewritten, so any additional hand-written code is lost. This
is especially problematic for technical configuration like cascading, fetch types and inference specification. Therefore, caution must be used when rebuilding the model.

There is a maven plugin configured in the project to run the generation (`jopa-maven-plugin`). It is set up so that it
executes only on demand. See `pom.xml` for more info.

## Persistence Setup

The persistence is set up in `cz.cvut.kbss.jopa.eswc2016.persistence.SesamePersistenceFactory` and `cz.cvut.kbss.jopa.eswc2016.persistence.OwlapiPersistenceFactory`.
Sesame native storage location is specified in `sesame.properties` in `src/main/resources`. Note that the path expects that the application is running on Linux. Feel free to specify
a different storage location (including remote repositories, just remember to adhere to the Sesame repository naming scheme).
Similarly, OWL API-managed storage is configured in `owlapi.properties`, it specifies logical and physical URI of the ontology and a mapping file for
resolving imports to local files.

## Running the Demo

This demo is a web application with UI written in TypeScript (using ReactJS). To run the application, run `mvn package` to build the WAR
for deployment. Next, copy the `mapping` and all the `.owl` and `.rdf` files from the project root to a location configured 
in `src/main/resources/owlapi.properties` (by default `/tmp/jopa`). Then WAR file into any Java EE 7 Web Profile-compliant server (Apache Tomcat, Jetty, Glassfish etc.).

In order to modify the application, NodeJS has to be installed on the system. Go to `src/main/webapp` and run `npm install` to install the frontend
dependencies. By executing `npm start`, a watcher will be started which rebuilds the UI bundle whenever a change is made to the source files.

The web UI is written in TypeScript and uses [React](https://facebook.github.io/react/) with [Redux](https://redux.js.org/) to manage the state.

The demo is also deployed and available at [http://kbss.felk.cvut.cz/jopa-eswc-demo/](http://kbss.felk.cvut.cz/jopa-eswc-demo/).
