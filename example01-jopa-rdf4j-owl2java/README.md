# JOPA Example 01 - JOPA + RDF4J + OWL2Java

This project is a basic example of JOPA usage. It uses an RDF4J in-memory storage and a small model based on the UOBM ontology 
([https://www.cs.ox.ac.uk/isg/tools/UOBMGenerator/](https://www.cs.ox.ac.uk/isg/tools/UOBMGenerator/)).

### Features

* Generated object model,
* Manually written object model,
* Entity lifecycle listeners,
* Language tag specification.

### Generated Model

This example uses an object model generated by OWL2Java. The generation is done as part of maven build and the generated
entities can be found in the `cz.cvut.kbss.jopa.example01.generated.model` package. The demo can be started using the 
`cz.cvut.kbss.jopa.example01.ExampleGenerated` class.

OWL2Java generates the classes based on integrity constraints in the `ic-example01.owl` file.

Technical constructs like operation cascading and lazy/eager loading have to be added manually.

*Note: Currently the generator always rewrites the whole classes, so no added code is preserved on maven rebuild.*

### Hand-written Model

This example uses a handwritten object model. The model does not contain all the constraints present in the generated-model,
but the attributes are, with the exception of annotation properties and @Properties, the same.
 
The model can be found in the `cz.cvut.kbss.jopa.example01.model` package and the demo can be run by starting the 
`cz.cvut.kbss.jopa.example01.Example` class.


### Entity Lifecycle Listeners

Similarly to JPA 2, JOPA enables declaration of listeners which are called at significant points in the lifecycle of an entity.
The `cz.cvut.kbss.jopa.example01.model.UndergraduateStudent` entity declares such listeners. In this case, the listeners
just log some messages, but additional logic can be put in them.
The semantics of the listeners corresponds to their semantics declared in the 
[JPA 2.1 specification](http://download.oracle.com/otndocs/jcp/persistence-2_1-fr-eval-spec/index.html).


### Language Tag Specification

JOPA allows language tag to be dynamically specified for whole entities or their attributes. The language tag is then applied
to String-based values (data and annotation properties). Check out the `cz.cvut.kbss.jopa.example01.ManualRunner.java` class,
in which both English and Czech names of courses are used. By default, the persistence unit uses English, but descriptors allow
to override this setting per entity or per individual attributes (so various languages can be combined in one entity).

## Persistence Setup

The persistence is set up in `cz.cvut.kbss.jopa.example01.PersistenceFactory`. A RDF4J volatile (in-memory) storage without
inference is used.

## Running the Demo

To run the demo, `mvn exec:java` can be used. However, make sure that `mvn package` or `mvn install` is executed first.

- To run the demo with the manually written object model, use `mvn exec:java@manual`*.
- To run the demo with the generated object model, use `mvn exec:java@generated`*.

*_Note that this requires Apache Maven 3.3.1 or later. If you have an older version, you can specify the object type model as 
command line argument in the following way:_ `mvn exec:java -Dexec.args=manual/generated`.
